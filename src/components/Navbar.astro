---
import { content } from "../data/content.js";
const waLink = content.whatsapp;
const brandName = content.brand.name;
---

<header>
  <div class="container">
    <div class="nav">
      <a class="logo" href="/">{brandName}</a>

      <nav aria-label="Navegación principal">
        <ul class="nav-links" role="list">
          <li><a href="#servicios">Servicios</a></li>
          <li><a href="#galeria">Galería</a></li>
          <li><a href="#ubicacion">Ubicación</a></li>
        </ul>
      </nav>

      <a
        class="nav-cta"
        href={waLink}
        target="_blank"
        rel="noopener noreferrer"
      >
        Reservar
      </a>

      <button
        class="hamburger"
        aria-label="Abrir menú"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

    <!-- Menú móvil desplegable -->
    <nav id="mobile-menu" class="mobile-menu" aria-label="Menú móvil" hidden>
      <a href="#servicios">Servicios</a>
      <a href="#galeria">Galería</a>
      <a href="#ubicacion">Ubicación</a>
      <a
        class="mobile-cta"
        href={waLink}
        target="_blank"
        rel="noopener noreferrer"
      >
        Reservar por WhatsApp
      </a>
    </nav>
  </div>
</header>
<div class="menu-overlay" hidden></div>

<script>
  const btn = document.querySelector(".hamburger");
  const menu = document.querySelector("#mobile-menu");
  const overlay = document.querySelector(".menu-overlay");

  if (btn && menu) {
    const setOpen = (open: boolean) => {
      btn.classList.toggle("is-open", open);
      menu.classList.toggle("is-open", open);
      btn.setAttribute("aria-expanded", String(open));
      menu.toggleAttribute("hidden", !open);

      overlay?.classList.toggle("is-open", open);
      overlay?.toggleAttribute("hidden", !open);
    };

    // Estado inicial coherente con "hidden"
    setOpen(false);

    btn.addEventListener("click", () => {
      const open = !btn.classList.contains("is-open");
      setOpen(open);
    });

    // Cerrar al clicar un enlace
    menu.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", () => setOpen(false));
    });

    // Cerrar con ESC
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") setOpen(false);
    });

    // Cerrar al clicar fuera
    document.addEventListener("click", (e) => {
      const target = e.target;
      if (!(target instanceof Node)) return; // <- type guard

      const clickedInside = btn.contains(target) || menu.contains(target);

      // Si clicas overlay, también es "fuera" => cierra
      if (!clickedInside) setOpen(false);
    });
  }
</script>
